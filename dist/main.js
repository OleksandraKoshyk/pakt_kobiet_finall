(()=>{"use strict";function t(t,e){return new Date(1e3*(t+e)).toUTCString().match(/\d{2}:\d{2}/)[0]}function e(t){return t.toLocaleDateString("pl-PL",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}function n(t,e,n=!1){const o=document.getElementById(`tasks-${t}`);if(!o)return;const s=document.createElement("li"),c=document.createElement("div");c.classList.add("task-left");const r=document.createElement("input");r.type="checkbox",r.checked=n,r.classList.add("form-check-input"),r.addEventListener("change",(()=>{r.checked?(i.classList.add("completed"),a(t,e,!0)):(i.classList.remove("completed"),a(t,e,!1))})),c.appendChild(r);const i=document.createElement("span");i.textContent=e,n&&i.classList.add("completed");const l=document.createElement("div");l.classList.add("task-right");const d=document.createElement("button");d.classList.add("btn-close"),d.setAttribute("aria-label","Close"),d.addEventListener("click",(()=>{!function(t,e){let n=JSON.parse(localStorage.getItem("tasks"))||{};n[t]&&(n[t]=n[t].filter((t=>t.text!==e)),localStorage.setItem("tasks",JSON.stringify(n)),function(t,e){const n=document.getElementById(`tasks-${t}`);if(n)for(const t of n.children)t.children[1].textContent===e&&t.remove()}(t,e))}(t,e)})),l.appendChild(d),s.appendChild(c),s.appendChild(i),s.appendChild(l),o.appendChild(s)}function a(t,e,n){let a=JSON.parse(localStorage.getItem("tasks"))||{};a[t]&&(a[t]=a[t].map((t=>t.text===e?{text:t.text,completed:n}:t)),localStorage.setItem("tasks",JSON.stringify(a)))}function o(t){return t.charAt(0).toUpperCase()+t.slice(1)}document.addEventListener("DOMContentLoaded",(()=>{!async function(){!function(){const t=(new Date).toISOString().split("T")[0];let e=JSON.parse(localStorage.getItem("tasks"))||{};console.log("tasks from localStorage.parse:",e);let n=!1;for(const a in e)a<t&&(delete e[a],n=!0);n&&localStorage.setItem("tasks",JSON.stringify(e))}();try{const s=await function(){const t=[52.2298,21.0118];return navigator.geolocation?new Promise(((e,n)=>{navigator.geolocation.getCurrentPosition((t=>{const{latitude:n,longitude:a}=t.coords;e([n,a])}),(()=>{console.warn("Geolokalizacja jest niedostępna. Używam domyślnych wartości."),e(t)}))})):(console.warn("Geolokalizacja nie jest obsługiwana przez przeglądarkę. Używam domyślnych współrzędnych."),Promise.resolve(t))}();console.log("coords from getUserCoords:",s);const c=await async function(t,e){const n=await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${t}&lon=${e}&lang=pl&units=metric&appid=845d9154d359e6b7488cc65cfdaf25fa`);if(!n.ok)throw displayCity("Nie udało się pobrać dannych z API pogodowego."),new Error("Nie udało się pobrać dannych z API pogodowego.");const a=await n.json();return console.log("response from fetch API:",a),a}(s[0],s[1]);a=c.city.name,document.getElementById("current-city").textContent=a,function(t){const e=document.getElementById("todolists");e.innerHTML="",t.forEach((t=>{const a=document.createElement("div");a.classList.add("todolist");const s=document.createElement("h2");s.textContent=o(t.date),a.appendChild(s);const c=document.createElement("div");c.classList.add("weather");const r=document.createElement("div");r.classList.add("weather-details");const i=document.createElement("img");i.src=t.icon,i.alt=t.weather,i.className="img-fluid";const l=document.createElement("div");l.innerHTML=`\n          <span>Temperatura: ${t.temperature} &deg;C</span><br>\n          <span>Pogoda: ${o(t.weather)}</span><br>\n          <span>Wschód: ${t.sunrise}</span><br>\n          <span>Zachód: ${t.sunset}</span>\n      `,r.appendChild(i),r.appendChild(l),c.appendChild(r),a.appendChild(c);const d=document.createElement("ul");d.classList.add("tasks"),d.id=`tasks-${t.fullDate}`,a.appendChild(d);const p=document.createElement("form");p.classList.add("add-task-form"),p.innerHTML='\n        <input type="text" placeholder="Nowe zadanie" class="form-control" required>\n        <button type="submit" class="btn btn-warning px-5">Dodaj</button>\n    ',p.addEventListener("submit",(e=>{e.preventDefault();const a=p.querySelector("input"),o=a.value.trim();""!==o&&(n(t.fullDate,o,!1),function(t,e,n=!1){let a=JSON.parse(localStorage.getItem("tasks"))||{};a[t]||(a[t]=[]),a[t].push({text:e,completed:n}),localStorage.setItem("tasks",JSON.stringify(a))}(t.fullDate,o),a.value="")})),a.appendChild(p),e.appendChild(a)})),function(){const t=JSON.parse(localStorage.getItem("tasks"))||{};for(const e in t)t[e].forEach((t=>{n(e,t.text,t.completed)}))}()}(function(n){if(!n||!n.list||!n.city)throw new Error("Nieprawidłowa struktura danych z API pogodowego.");const a=[],o=(new Date).toISOString().split("T")[0];return console.log("today from processWeatherData:",o),n.list.forEach((s=>{const c=new Date(1e3*s.dt),r=c.toISOString().split("T")[0],i=c.toISOString().split("T")[1].split(":")[0];a.length<4&&(a.some((t=>t.fullDate===r))||r!==o&&(r===o||"09"!==i)||a.push({fullDate:r,date:e(c),temperature:Math.round(s.main.temp),weather:s.weather[0].description,icon:`https://openweathermap.org/img/wn/${s.weather[0].icon}@2x.png`,sunrise:t(n.city.sunrise,n.city.timezone),sunset:t(n.city.sunset,n.city.timezone)}))})),console.log("dailyData from processWeatherData:",a),a}(c))}catch(t){console.error("Błąd inicjalizacji aplikacji:",t)}var a}()}))})();